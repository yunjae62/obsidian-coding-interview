### 프로메테우스
- 오픈소스 시계열 기반 모니터링 시스템
- 주기적으로 Pulling 방식으로 수집하며, 내장된 시계열 데이터베이스로 디스크에 저장
- 다양한 플러그인 지원하며 단일 바이너리로 단독으로 동작

### 프로메테우스 구조

![프로메테우스 구조](https://prometheus.io/assets/architecture.png)
- Target System : 프로메테우스가 수집할 대상 시스템
- Exporter : 타깃 시스템에서 프로메테우스 서버가 수집할 수 있도록 HTTP 엔드포인트를 노출하는 컴포넌트
	- Exporter 자체는 단순히 텍스트 형태로 리턴하며 메트릭을 저장하지 않음
- Retrieval : 서비스 디스커버리로 또는 설정된 타깃 목록으로부터 Exporter를 인식하고 주기적으로 메트릭을 수집하는 컴포넌트
- TSDB : 시계열 데이터베이스. Retrieval이 수집한 메트릭을 저장하는 컴포넌트. 고성능 압축 및 조회를 지원하며, 일정 기간 이후에 자동으로 데이터가 삭제된다.
- PromQL : 프로메테우스에 저장된 데이터를 조회 및 집계하는 전용 쿼리 언어.
- Alertmanager : 메트릭 조건에 따라 알림을 생성하고 전송하는 컴포넌트. 프로메테우스는 Alert Rule만 설정하고, 실제 전송은 이 컴포넌트가 담당한다.
- Pushgateway : 짧은 수명의 Job(Cron, Batch)에서 메트릭을 직접 Push할 수 있도록 중간에 사용하는 컴포넌트. 여기에 임시 저장된 것을 프로메테우스 서버가 pull 하는 형태이다.

### Push 방식 vs Pull 방식

| 구분     | Push 방식                              | Pull 방식                              |
| ------ | ------------------------------------ | ------------------------------------ |
| 데이터 흐름 | 대상 시스템이 모니터링 시스템에 메트릭을 직접 전송         | 모니터링 시스템이 대상 시스템의 Exporter에 주기적으로 요청 |
| 장점     | - 방화벽 설정 단순<br>- 외부 접근 불가능한 시스템에서 유리 | - 장애 원인 분석 쉬움<br>- 설정 및 관리 단순        |
| 단점     | - 수신 서버에 부하 집중                       | - 네트워크 접근 어려운 환경에서는 수집 불가            |
| 대표 도구  | Zabbix, Datadog                      | Prometheus                           |
- 일반적인 Pull 방식은 오토 스케일링처럼 대상 인스턴스가 동적으로 생성/삭제되는 환경에서 수집이 어렵지만, 프로메테우스는 서비스 디스커버리를 통해 자동으로 타깃을 인식할 수 있어 이 문제를 해결함.

